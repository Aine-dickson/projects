import{d as K,i as B,c as w,z as Q,q as X,s as Y,a as n,o as d,b as e,t as l,u as a,n as v,g as u,p,G as c,e as Z,F as g,h as f,f as F}from"./index-2ZCFnJi3.js";import{u as ee}from"./telemetry-Ci6jwsh_.js";import{S as I}from"./Sparkline-DyCppi-C.js";import"./_commonjsHelpers-Bx2EM-6T.js";const te={class:"space-y-6 text-xs"},se={class:"grid gap-3 sm:grid-cols-3"},re={class:"p-4 rounded-lg border bg-white dark:bg-neutral-900 border-neutral-200 dark:border-neutral-700 flex flex-col gap-1"},le={class:"text-lg font-semibold"},ae={class:"p-4 rounded-lg border bg-white dark:bg-neutral-900 border-neutral-200 dark:border-neutral-700 flex flex-col gap-1"},oe={class:"text-lg font-semibold"},ne={class:"p-4 rounded-lg border bg-white dark:bg-neutral-900 border-neutral-200 dark:border-neutral-700 flex flex-col gap-1"},de={class:"p-4 rounded-lg border bg-white dark:bg-neutral-900 border-neutral-200 dark:border-neutral-700 space-y-4"},ie={class:"flex flex-wrap gap-6"},ue={class:"space-y-2 flex-1 min-w-[320px]"},pe={class:"flex items-center gap-4 flex-wrap"},ce={class:"flex items-center gap-2 flex-wrap text-[11px]"},me={class:"flex items-center gap-1"},be={class:"flex items-center gap-1"},xe={class:"flex items-center gap-1"},ve={class:"flex items-center gap-1"},ge={class:"ml-auto flex gap-2"},fe={class:"space-y-2 flex-1 min-w-[280px]"},he={class:"font-semibold text-sm flex items-center gap-2"},_e={class:"flex flex-wrap gap-2 text-[11px] items-end"},ye={class:"flex flex-col"},ke={class:"flex flex-col"},we={class:"flex flex-col"},Se={class:"grid gap-6 lg:grid-cols-3"},Ce={class:"space-y-4 lg:col-span-2"},Te={class:"p-4 rounded-lg border bg-white dark:bg-neutral-900 border-neutral-200 dark:border-neutral-700 space-y-2"},Me={class:"overflow-auto max-h-64 thin-scroll"},Ee={class:"w-full text-[11px]"},Ae={class:"py-1 pr-2 whitespace-nowrap"},De={class:"py-1 pr-2"},Ue={class:"py-1 pr-2 uppercase"},Re={class:"py-1 pr-2"},Le={class:"py-1 pr-2"},Ve={class:"py-1 pr-2"},Be={class:"py-1 pr-2"},Fe={class:"p-4 rounded-lg border bg-white dark:bg-neutral-900 border-neutral-200 dark:border-neutral-700 space-y-2"},Ie={class:"overflow-auto max-h-64 thin-scroll"},He={class:"w-full text-[11px]"},Ne={class:"py-1 pr-2 whitespace-nowrap"},je={class:"py-1 pr-2"},ze={class:"py-1 pr-2 uppercase"},Oe={class:"space-y-4"},Pe={class:"p-4 rounded-lg border bg-white dark:bg-neutral-900 border-neutral-200 dark:border-neutral-700 space-y-3"},$e={class:"overflow-auto max-h-32 thin-scroll"},qe={class:"w-full text-[11px] mb-2"},Ge={class:"py-1 pr-2"},We={class:"py-1 pr-2"},Je={class:"py-1 pr-2"},Ke={class:"py-1 pr-2"},Qe={class:"py-1 pr-2"},Xe={class:"space-y-2"},Ye={class:"flex flex-wrap gap-2"},Ze={class:"w-10 text-neutral-500"},et={class:"flex flex-wrap gap-2"},tt={class:"w-10 text-neutral-500"},st={class:"p-4 rounded-lg border bg-white dark:bg-neutral-900 border-neutral-200 dark:border-neutral-700 space-y-2"},rt={class:"space-y-1 max-h-64 overflow-auto thin-scroll"},lt={class:"font-mono text-neutral-400"},at={class:"font-medium"},ot={class:"uppercase"},ct=K({__name:"TelemetryDashboard",setup(nt){const r=ee(),m=B(!1);let h;const E=w({get:()=>Math.round(r.thresholds.staleMs/1e3),set:o=>r.thresholds.staleMs=o*1e3});function H(){r.thresholds.tempHigh=75,r.thresholds.cpuHigh=.85,r.thresholds.staleMs=12e4}const b=B("idle");let S,y;Q(()=>({...r.thresholds}),()=>{y&&(clearTimeout(y),y=null),b.value="saving",S&&clearTimeout(S),S=setTimeout(()=>{b.value="saved",y=setTimeout(()=>b.value="idle",2e3)},600)},{deep:!0});const A=w(()=>b.value==="idle"?"":b.value==="saving"?"Saving…":"Saved"),N=w(()=>b.value==="saving"?"bg-amber-100 text-amber-700 dark:bg-amber-900/40 dark:text-amber-300":"bg-emerald-100 text-emerald-700 dark:bg-emerald-900/40 dark:text-emerald-300");function C(o){return new Date(o).toLocaleTimeString([],{hour12:!1,hour:"2-digit",minute:"2-digit",second:"2-digit"})}function j(o){return o==="ALERT"?"bg-red-100 text-red-700 dark:bg-red-900/40 dark:text-red-300":o==="STALE"?"bg-amber-100 text-amber-700 dark:bg-amber-900/40 dark:text-amber-300":"bg-emerald-100 text-emerald-700 dark:bg-emerald-900/40 dark:text-emerald-300"}function z(o){return o.metric==="cpu"?(o.value*100).toFixed(0)+"%":o.value.toFixed(1)}function k(){const o=Date.now(),s=[];for(let t=0;t<r.simulator.deviceCount;t++){const _="dev-"+(t+1).toString().padStart(2,"0");for(let x=0;x<r.simulator.batchSize;x++){const i=new Date(o+x*50).toISOString(),G=50+(Math.random()-.5)*r.simulator.tempNoise,W=.4+Math.random()*.7,J=30+Math.random()*40;s.push({device_id:_,metric:"temp",value:G,ts:i}),s.push({device_id:_,metric:"cpu",value:W,ts:i}),s.push({device_id:_,metric:"mem",value:J,ts:i})}}r.ingestLocalBatch(s)}function O(){k()}function P(){m.value=!m.value,m.value?D():T()}function D(){h||(k(),h=setInterval(k,r.simulator.intervalMs))}function T(){h&&(clearInterval(h),h=null)}let U;X(()=>{r.initRealtime(),r.rawEvents.length||k(),U=setInterval(()=>{m.value&&(T(),D())},5e3)}),Y(()=>{T(),clearInterval(U)});const M=w(()=>Object.values(r.deviceState));function R(o){return o==="ALERT"?"#dc2626":o==="STALE"?"#d97706":"#059669"}function L(o){return o.map(s=>s.map(t=>/[",\n]/.test(t)?'"'+t.replace(/"/g,'""')+'"':t).join(",")).join(`
`)}function V(o,s,t="text/csv"){const _=new Blob([s],{type:t}),x=URL.createObjectURL(_),i=document.createElement("a");i.href=x,i.download=o,document.body.appendChild(i),i.click(),i.remove(),URL.revokeObjectURL(x)}function $(){if(!r.rawEvents.length)return;const s=[["ts","device_id","metric","value"],...r.rawEvents.slice(0,500).map(t=>[t.ts,t.device_id,t.metric,String(t.value)])];V(`telemetry-events-${Date.now()}.csv`,L(s))}function q(){if(!r.alerts.length)return;const s=[["ts","device_id","metric","severity","message"],...r.alerts.slice(0,200).map(t=>[t.ts,t.device_id,t.metric,t.severity,t.message])];V(`telemetry-alerts-${Date.now()}.csv`,L(s))}return(o,s)=>(d(),n("div",te,[e("section",se,[e("div",re,[s[8]||(s[8]=e("span",{class:"text-neutral-500"},"Events",-1)),e("span",le,l(a(r).totalEvents),1)]),e("div",ae,[s[9]||(s[9]=e("span",{class:"text-neutral-500"},"Devices",-1)),e("span",oe,l(a(r).activeDevices),1)]),e("div",ne,[s[10]||(s[10]=e("span",{class:"text-neutral-500"},"Alerts",-1)),e("span",{class:v(["text-lg font-semibold",a(r).alertCount?"text-red-600 dark:text-red-400":"text-neutral-600"])},l(a(r).alertCount),3)])]),e("section",de,[e("div",ie,[e("div",ue,[e("header",pe,[s[15]||(s[15]=e("h2",{class:"font-semibold text-sm"},"Ingestion Simulator",-1)),e("div",ce,[e("label",me,[s[11]||(s[11]=u("Devices ")),p(e("input",{type:"number",min:"1",max:"50","onUpdate:modelValue":s[0]||(s[0]=t=>a(r).simulator.deviceCount=t),class:"w-16 rounded border border-neutral-300 dark:border-neutral-700 bg-transparent px-1 py-0.5"},null,512),[[c,a(r).simulator.deviceCount,void 0,{number:!0}]])]),e("label",be,[s[12]||(s[12]=u("Interval(ms) ")),p(e("input",{type:"number",min:"500",step:"100","onUpdate:modelValue":s[1]||(s[1]=t=>a(r).simulator.intervalMs=t),class:"w-20 rounded border border-neutral-300 dark:border-neutral-700 bg-transparent px-1 py-0.5"},null,512),[[c,a(r).simulator.intervalMs,void 0,{number:!0}]])]),e("label",xe,[s[13]||(s[13]=u("Batch ")),p(e("input",{type:"number",min:"1",max:"100","onUpdate:modelValue":s[2]||(s[2]=t=>a(r).simulator.batchSize=t),class:"w-16 rounded border border-neutral-300 dark:border-neutral-700 bg-transparent px-1 py-0.5"},null,512),[[c,a(r).simulator.batchSize,void 0,{number:!0}]])]),e("label",ve,[s[14]||(s[14]=u("Temp Noise ")),p(e("input",{type:"number",step:"1","onUpdate:modelValue":s[3]||(s[3]=t=>a(r).simulator.tempNoise=t),class:"w-16 rounded border border-neutral-300 dark:border-neutral-700 bg-transparent px-1 py-0.5"},null,512),[[c,a(r).simulator.tempNoise,void 0,{number:!0}]])])]),e("div",ge,[e("button",{onClick:P,class:v(["px-3 py-1 rounded-md text-xs font-medium",m.value?"bg-red-600 text-white":"bg-neutral-900 text-white dark:bg-white dark:text-neutral-900"])},l(m.value?"Stop":"Start"),3),e("button",{onClick:O,class:"px-3 py-1 rounded-md text-xs font-medium bg-neutral-200 dark:bg-neutral-700"},"Ingest Once"),e("button",{onClick:s[4]||(s[4]=(...t)=>a(r).clearAll&&a(r).clearAll(...t)),class:"px-3 py-1 rounded-md text-xs font-medium bg-neutral-100 dark:bg-neutral-800"},"Clear")])]),s[16]||(s[16]=e("p",{class:"text-neutral-500 text-[11px]"},"Synthetic metrics (temp °C, cpu 0-1, mem MB). Realtime subscription auto-enables if backend tables exist.",-1))]),e("div",fe,[e("h3",he,[s[17]||(s[17]=u("Alert Rules ")),A.value?(d(),n("span",{key:0,class:v([N.value,"text-[10px] px-2 py-0.5 rounded-full"])},l(A.value),3)):Z("",!0)]),e("div",_e,[e("label",ye,[s[18]||(s[18]=u("Temp High ")),p(e("input",{type:"number","onUpdate:modelValue":s[5]||(s[5]=t=>a(r).thresholds.tempHigh=t),class:"mt-0.5 w-20 rounded border border-neutral-300 dark:border-neutral-700 bg-transparent px-1 py-0.5"},null,512),[[c,a(r).thresholds.tempHigh,void 0,{number:!0}]])]),e("label",ke,[s[19]||(s[19]=u("CPU High ")),p(e("input",{type:"number",step:"0.01","onUpdate:modelValue":s[6]||(s[6]=t=>a(r).thresholds.cpuHigh=t),class:"mt-0.5 w-20 rounded border border-neutral-300 dark:border-neutral-700 bg-transparent px-1 py-0.5"},null,512),[[c,a(r).thresholds.cpuHigh,void 0,{number:!0}]])]),e("label",we,[s[20]||(s[20]=u("Stale (s) ")),p(e("input",{type:"number",min:"10",step:"5","onUpdate:modelValue":s[7]||(s[7]=t=>E.value=t),class:"mt-0.5 w-24 rounded border border-neutral-300 dark:border-neutral-700 bg-transparent px-1 py-0.5"},null,512),[[c,E.value,void 0,{number:!0}]])]),e("button",{onClick:H,class:"px-3 py-1 rounded-md text-xs font-medium bg-neutral-100 dark:bg-neutral-800"},"Reset")]),s[21]||(s[21]=e("p",{class:"text-neutral-500 text-[11px]"},"Adjust thresholds; changes persist locally.",-1))])])]),e("section",Se,[e("div",Ce,[e("div",Te,[s[23]||(s[23]=e("h3",{class:"font-semibold text-sm"},"Recent Aggregates (Minute Buckets)",-1)),e("div",Me,[e("table",Ee,[s[22]||(s[22]=e("thead",{class:"text-neutral-500"},[e("tr",{class:"text-left"},[e("th",{class:"font-medium py-1 pr-2"},"Bucket"),e("th",{class:"font-medium py-1 pr-2"},"Device"),e("th",{class:"font-medium py-1 pr-2"},"Metric"),e("th",{class:"font-medium py-1 pr-2"},"Cnt"),e("th",{class:"font-medium py-1 pr-2"},"Avg"),e("th",{class:"font-medium py-1 pr-2"},"Min"),e("th",{class:"font-medium py-1 pr-2"},"Max")])],-1)),e("tbody",null,[(d(!0),n(g,null,f(a(r).minuteAggs.slice(0,50),t=>(d(),n("tr",{key:t.bucket_start+t.device_id+t.metric,class:"border-t border-neutral-100 dark:border-neutral-800"},[e("td",Ae,l(C(t.bucket_start)),1),e("td",De,l(t.device_id),1),e("td",Ue,l(t.metric),1),e("td",Re,l(t.count),1),e("td",Le,l(t.avg_val.toFixed(1)),1),e("td",Ve,l(t.min_val.toFixed(1)),1),e("td",Be,l(t.max_val.toFixed(1)),1)]))),128))])])])]),e("div",Fe,[s[25]||(s[25]=e("h3",{class:"font-semibold text-sm"},"Raw Events (Most Recent)",-1)),e("div",Ie,[e("table",He,[s[24]||(s[24]=e("thead",{class:"text-neutral-500"},[e("tr",{class:"text-left"},[e("th",{class:"font-medium py-1 pr-2"},"TS"),e("th",{class:"font-medium py-1 pr-2"},"Device"),e("th",{class:"font-medium py-1 pr-2"},"Metric"),e("th",{class:"font-medium py-1 pr-2"},"Value")])],-1)),e("tbody",null,[(d(!0),n(g,null,f(a(r).rawEvents.slice(0,60),t=>(d(),n("tr",{key:t.ts+t.device_id+t.metric,class:"border-t border-neutral-100 dark:border-neutral-800"},[e("td",Ne,l(C(t.ts)),1),e("td",je,l(t.device_id),1),e("td",ze,l(t.metric),1),e("td",{class:v(["py-1 pr-2",t.metric==="temp"&&t.value>75||t.metric==="cpu"&&t.value>.85?"text-red-600 dark:text-red-400":""])},l(z(t)),3)]))),128))])])])])]),e("div",Oe,[e("div",Pe,[s[29]||(s[29]=e("h3",{class:"font-semibold text-sm"},"Device State",-1)),e("div",$e,[e("table",qe,[s[26]||(s[26]=e("thead",{class:"text-neutral-500"},[e("tr",{class:"text-left"},[e("th",{class:"py-1 pr-2 font-medium"},"Device"),e("th",{class:"py-1 pr-2 font-medium"},"Status"),e("th",{class:"py-1 pr-2 font-medium"},"Temp"),e("th",{class:"py-1 pr-2 font-medium"},"CPU"),e("th",{class:"py-1 pr-2 font-medium"},"Mem")])],-1)),e("tbody",null,[(d(!0),n(g,null,f(M.value,t=>(d(),n("tr",{key:t.device_id,class:"border-t border-neutral-100 dark:border-neutral-800"},[e("td",Ge,l(t.device_id),1),e("td",We,[e("span",{class:v([j(t.status),"px-2 py-0.5 rounded-full"])},l(t.status),3)]),e("td",Je,l((t.last_values.temp??0).toFixed(1)),1),e("td",Ke,l(((t.last_values.cpu??0)*100).toFixed(0))+"%",1),e("td",Qe,l((t.last_values.mem??0).toFixed(0)),1)]))),128))])])]),e("div",Xe,[s[27]||(s[27]=e("h4",{class:"font-medium text-[11px] text-neutral-500"},"Temp (Last 50 samples)",-1)),e("div",Ye,[(d(!0),n(g,null,f(M.value,t=>(d(),n("div",{key:t.device_id+"-temp",class:"flex items-center gap-1 text-[10px]"},[e("span",Ze,l(t.device_id),1),F(I,{values:a(r).getSeries(t.device_id,"temp"),color:R(t.status)},null,8,["values","color"])]))),128))]),s[28]||(s[28]=e("h4",{class:"font-medium text-[11px] text-neutral-500 pt-1"},"CPU",-1)),e("div",et,[(d(!0),n(g,null,f(M.value,t=>(d(),n("div",{key:t.device_id+"-cpu",class:"flex items-center gap-1 text-[10px]"},[e("span",tt,l(t.device_id),1),F(I,{values:a(r).getSeries(t.device_id,"cpu"),color:R(t.status)},null,8,["values","color"])]))),128))])])]),e("div",st,[e("h3",{class:"font-semibold text-sm flex items-center justify-between"},[s[30]||(s[30]=u("Alerts ")),e("span",{class:"flex gap-1"},[e("button",{onClick:$,class:"px-2 py-0.5 rounded bg-neutral-100 dark:bg-neutral-800 text-[10px]"},"Export Events"),e("button",{onClick:q,class:"px-2 py-0.5 rounded bg-neutral-100 dark:bg-neutral-800 text-[10px]"},"Export Alerts")])]),e("ul",rt,[(d(!0),n(g,null,f(a(r).recentAlerts,t=>(d(),n("li",{key:t.id,class:"flex items-center gap-2 text-[11px]"},[e("span",lt,l(C(t.ts)),1),e("span",at,l(t.device_id),1),e("span",ot,l(t.metric),1),e("span",{class:v(t.severity==="crit"?"text-red-600 dark:text-red-400":"text-amber-600 dark:text-amber-400")},l(t.message),3)]))),128))])])])])]))}});export{ct as default};
