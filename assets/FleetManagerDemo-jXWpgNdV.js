import{M as we,i as b,c as P,d as Me,q as Ce,s as Le,z as Re,a as m,o as g,b as t,e as re,F as H,h as q,g as R,p as S,v as Ee,t as p,u as k,G as z,n as ee,E as xe,P as De,f as ye,_ as W,L as Te,O as ke,Q as Fe}from"./index-C9_qrIFG.js";import{S as _e}from"./Sparkline-CjhuEQ9e.js";const Ie=we("fleet",()=>{const J=b({vehicleCount:6,autoSimulate:!0,engineTempHigh:95,minFuelWarn:12}),i=b([]),T=b([]),h=b({}),F=b([{id:"gf1",name:"Depot",lat:.3476,lng:32.5825,radiusM:800}]),B=b(["Amina","Brian","Claire","David","Esther","Felix"]),Q={"Kampala Loop":[[.3476,32.5825],[.3505,32.6],[.335,32.61],[.32,32.6],[.326,32.585],[.34,32.575],[.3476,32.5825]],"Kampala–Entebbe":[[.3476,32.5825],[.3,32.56],[.25,32.52],[.18,32.5],[.1,32.48],[.05,32.46],[.04,32.45]],"Kampala–Jinja":[[.3476,32.5825],[.36,32.65],[.37,32.72],[.38,32.8],[.39,32.9],[.42,33]],"Northern Bypass":[[.37,32.55],[.365,32.57],[.36,32.59],[.355,32.61],[.35,32.63]]},x=b([]),E={},I={},U={};function ie(){return[...Object.keys(Q),...x.value.map(r=>r.name)]}function N(r){var a;return Q[r]||((a=x.value.find(l=>l.name===r))==null?void 0:a.points)}function Z(r,a){N(r)||x.value.push({name:r,points:a})}function te(r){const a=x.value.findIndex(l=>l.name===r);a>=0&&x.value.splice(a,1)}function K(r){if(U[r]!=null)return U[r];const a=N(r);if(!a||a.length<2)return U[r]=0;let l=0;for(let u=0;u<a.length-1;u++)l+=G(a[u][0],a[u][1],a[u+1][0],a[u+1][1]);return U[r]=l}function _(r){const a=i.value.find(e=>e.id===r);if(!a||!a.route)return{distanceTraveledM:0,totalDistanceM:0,remainingM:0,etaSeconds:null};const l=N(a.route);if(!l)return{distanceTraveledM:0,totalDistanceM:0,remainingM:0,etaSeconds:null};const u=E[a.id],f=K(a.route);if(!u||f===0)return{distanceTraveledM:0,totalDistanceM:f,remainingM:f,etaSeconds:null};let v=0;for(let e=0;e<u.seg;e++)v+=G(l[e][0],l[e][1],l[e+1][0],l[e+1][1]);const D=l[u.seg],M=l[(u.seg+1)%l.length];v+=G(D[0],D[1],M[0],M[1])*u.t;const V=Math.max(0,f-v),C=I[a.id]||0,s=C>.3?V/C:null;return{distanceTraveledM:v,totalDistanceM:f,remainingM:V,etaSeconds:s}}function X(){if(!i.value.length)for(let l=0;l<J.value.vehicleCount;l++)i.value.push({id:"V"+(l+1),name:"Vehicle "+(l+1),lat:.3476+(Math.random()-.5)*.02,lng:32.5825+(Math.random()-.5)*.02,fuel:40+Math.random()*50,engineTemp:70+Math.random()*10,odometerKm:1e4+Math.random()*5e3,lastUpdate:new Date().toISOString(),alert:null})}function de(){const r=Date.now();i.value=i.value.map(a=>{const l=a.route&&N(a.route),u=!!(l&&l.length>1&&a.driver);let f=a.lat,v=a.lng;if(u){const d=E[a.id]||(E[a.id]={seg:0,t:0});l[d.seg],l[(d.seg+1)%l.length];const c=.18+Math.random()*.08;d.t+=c*.1,d.t>=1&&(d.t-=1,d.seg=(d.seg+1)%l.length);const y=l[d.seg],A=l[(d.seg+1)%l.length];f=y[0]+(A[0]-y[0])*d.t+(Math.random()-.5)*3e-4,v=y[1]+(A[1]-y[1])*d.t+(Math.random()-.5)*3e-4}let D=a.engineTemp,M=a.fuel,V=a.odometerKm,C=null;if(u){const d=.02+Math.random()*.05,c=(Math.random()-.5)*1.5+(Math.random()<.05?8:0);D=Math.max(60,D+c),M=Math.max(0,M-d),V=V+.2+Math.random()*.15,D>J.value.engineTempHigh?C="ENGINE":M<J.value.minFuelWarn&&(C="MAINT"),C&&ne(a.id,C,C==="ENGINE"?`High engine temp ${D.toFixed(1)}°C`:`Low fuel ${M.toFixed(1)}%`)}const s=new Date(a.lastUpdate).getTime(),e=(r-s)/1e3||1,o=G(a.lat,a.lng,f,v)/e;if(I[a.id]=I[a.id]!=null?I[a.id]*.7+o*.3:o,u){const d=h.value[a.id]||(h.value[a.id]=[]);d.push([f,v]),d.length>120&&d.splice(0,d.length-120);for(const c of F.value){const y=G(c.lat,c.lng,f,v);y>c.radiusM*4&&Math.random()<.005&&ne(a.id,"GEOFENCE",`${a.id} far from ${c.name} (${(y/1e3).toFixed(1)}km)`)}}return{...a,lat:f,lng:v,fuel:M,engineTemp:D,odometerKm:V,lastUpdate:new Date(r).toISOString(),alert:C}})}function ne(r,a,l){T.value.unshift({id:Date.now().toString(36)+Math.random().toString(36).slice(2,6),vehicleId:r,type:a,message:l,ts:new Date().toISOString()}),T.value.length>200&&T.value.splice(200)}function ae(r,a){const l=i.value.find(u=>u.id===r);l&&(l.route=a)}function ue(r,a){const l=i.value.find(u=>u.id===r);l&&(l.driver=a)}const ce=P(()=>T.value.slice(0,50)),le=P(()=>i.value.filter(r=>r.alert).length),pe=P(()=>i.value.length?i.value.reduce((r,a)=>r+a.fuel,0)/i.value.length:0),O=P(()=>i.value.reduce((r,a)=>r+a.odometerKm%50,0));function oe(){i.value=[],T.value=[],h.value={}}function G(r,a,l,u){const v=C=>C*Math.PI/180,D=v(l-r),M=v(u-a),V=Math.sin(D/2)**2+Math.cos(v(r))*Math.cos(v(l))*Math.sin(M/2)**2;return 2*6371e3*Math.atan2(Math.sqrt(V),Math.sqrt(1-V))}function me(){const r=["id","driver","route","lat","lng","fuel","engineTemp","odometerKm","alert","lastUpdate"],a=i.value.map(l=>[l.id,l.driver||"",l.route||"",l.lat.toFixed(6),l.lng.toFixed(6),l.fuel.toFixed(1),l.engineTemp.toFixed(1),l.odometerKm.toFixed(1),l.alert||"",l.lastUpdate]);return $([r,...a])}function ge(){const r=["ts","vehicleId","type","message"],a=T.value.slice(0,500).map(l=>[l.ts,l.vehicleId,l.type,l.message]);return $([r,...a])}function $(r){return r.map(a=>a.map(l=>/[",\n]/.test(l)?'"'+l.replace(/"/g,'""')+'"':l).join(",")).join(`
`)}function fe(r,a,l,u){F.value.push({id:"gf"+Date.now().toString(36),name:r,lat:a,lng:l,radiusM:u})}function he(r,a){const l=F.value.find(u=>u.id===r);l&&(l.radiusM=a)}function se(r,a,l){const u=F.value.find(f=>f.id===r);u&&(u.lat=a,u.lng=l)}function j(r,a){const l=F.value.find(u=>u.id===r);l&&(l.name=a)}function ve(r){const a=F.value.findIndex(l=>l.id===r);a>=0&&F.value.splice(a,1)}function Y(r){B.value.includes(r)||B.value.push(r)}return{config:J,vehicles:i,alerts:T,history:h,geofences:F,drivers:B,customRoutes:x,activeAlerts:ce,vehicleAlertCount:le,avgFuel:pe,totalDistanceToday:O,initIfEmpty:X,simulateStep:de,assignDriver:ue,assignRoute:ae,clear:oe,exportVehiclesCsv:me,exportAlertsCsv:ge,addGeofence:fe,updateGeofenceRadius:he,updateGeofenceCenter:se,renameGeofence:j,removeGeofence:ve,addDriver:Y,allRouteNames:ie,addCustomRoute:Z,removeCustomRoute:te,getRoutePoints:N,routeMetrics:_}},{persist:{key:"fleet",paths:["config","geofences","drivers","customRoutes"]}}),Ve={class:"space-y-5 text-xs"},Ae={class:"grid lg:grid-cols-3 gap-5"},Se={class:"lg:col-span-2 space-y-5"},Ue={class:"h-72 rounded-lg border border-neutral-200 dark:border-neutral-700 overflow-hidden relative z-10"},Ne={key:0,class:"absolute inset-0 flex items-center justify-center text-neutral-500"},Ge={class:"absolute bottom-2 left-2 z-20 bg-white/80 dark:bg-neutral-800/80 backdrop-blur rounded p-2 border border-neutral-300 dark:border-neutral-600"},Pe={class:"space-y-0.5 text-[10px] max-w-[160px]"},Oe={class:"p-4 rounded-lg border bg-white dark:bg-neutral-900 border-neutral-200 dark:border-neutral-700 space-y-2"},ze={class:"flex items-center gap-3 flex-wrap"},Ke={class:"flex gap-2 text-[10px] items-center"},$e={class:"flex items-center gap-1"},je={class:"ml-auto flex gap-3 text-[10px] text-neutral-500"},He={class:"overflow-auto max-h-56 thin-scroll"},Be={class:"w-full text-[11px]"},qe=["onClick"],We={class:"py-1 pr-2 font-mono"},Je={class:"py-1 pr-2"},Qe=["onUpdate:modelValue"],Ze=["value"],Xe={class:"py-1 pr-2"},Ye=["onUpdate:modelValue"],et=["value"],tt={class:"py-1 pr-2"},nt={class:"py-1 pr-2"},at={class:"py-1 pr-2 whitespace-nowrap"},lt={key:0},ot={key:0},st={key:1,class:"text-neutral-400"},rt={key:1,class:"text-neutral-400"},it={class:"py-1 pr-2"},dt={class:"space-y-5"},ut={class:"p-4 rounded-lg border bg-white dark:bg-neutral-900 border-neutral-200 dark:border-neutral-700 space-y-3"},ct={class:"space-y-1 max-h-40 overflow-auto thin-scroll"},pt={class:"font-mono text-neutral-400"},mt={class:"font-semibold"},gt={class:"p-4 rounded-lg border bg-white dark:bg-neutral-900 border-neutral-200 dark:border-neutral-700 space-y-3"},ft={class:"flex flex-col gap-2 text-[11px]"},ht={class:"flex items-center gap-1"},vt={class:"flex items-center gap-1"},bt={class:"flex items-center gap-1"},xt={class:"flex items-center gap-1"},yt={class:"flex items-center gap-2"},kt={key:0,class:"text-[10px] text-emerald-600"},_t={key:1,class:"text-[10px] text-neutral-500"},wt={class:"p-4 rounded-lg border bg-white dark:bg-neutral-900 border-neutral-200 dark:border-neutral-700 space-y-3"},Mt={class:"space-y-1 max-h-32 overflow-auto thin-scroll"},Ct=["onUpdate:modelValue"],Lt=["onUpdate:modelValue"],Rt=["onClick"],Et={class:"flex items-center gap-1 text-[11px]"},Dt={class:"w-full max-w-lg rounded-lg border border-neutral-300 dark:border-neutral-700 bg-white dark:bg-neutral-900 p-5 space-y-4 relative"},Tt={class:"text-lg font-semibold flex items-center gap-2"},Ft={class:"text-xs font-normal text-neutral-500"},It={class:"grid grid-cols-2 gap-4 text-[11px]"},Vt={class:"space-y-1"},At={class:"space-y-1"},St={key:1},Ut={class:"space-y-2"},Nt={class:"text-sm font-medium"},Gt=Me({__name:"FleetManagerDemo",setup(J){const i=Ie(),T=b(null);let h,F=[],B=[],Q=[],x=null;const E=b(!1),I=[],U=b("");function ie(s){if(i.vehicles.length<25)return;const e={},n=.01;i.vehicles.forEach(o=>{const d=Math.round(o.lat/n)+":"+Math.round(o.lng/n),c=e[d]||(e[d]={lat:0,lng:0,count:0});c.lat+=o.lat,c.lng+=o.lng,c.count++}),Object.values(e).forEach(o=>{o.lat/=o.count,o.lng/=o.count;const d=s.divIcon({className:"cluster-marker",html:`<div class='px-2 py-1 text-[10px] rounded-full bg-indigo-600 text-white border border-white shadow'>${o.count}</div>`});s.marker([o.lat,o.lng],{icon:d}).addTo(h)})}const N=b(!1),Z=b(!0);let te;const K=b(null),_=P(()=>i.vehicles.find(s=>s.id===K.value)),X=P(()=>K.value?i.history[K.value]||[]:[]),de=P(()=>X.value.map(s=>s[0])),ne=P(()=>X.value.map(s=>s[1]));function ae(s){return i.routeMetrics(s)}function ue(s){if(s<60)return s.toFixed(0)+"s";const e=s/60;return e<60?e.toFixed(0)+"m":(e/60).toFixed(1)+"h"}function ce(s){return new Date(s).toLocaleTimeString([],{hour12:!1,hour:"2-digit",minute:"2-digit",second:"2-digit"})}function le(s){const e=(Date.now()-new Date(s).getTime())/1e3;if(e<60)return e.toFixed(0)+"s";const n=e/60;return n<60?n.toFixed(0)+"m":(n/60).toFixed(1)+"h"}async function pe(){var s,e;if(T.value)try{const n=await W(()=>import("./leaflet-src-r9KgTLRM.js").then(o=>o.l),[]);if(!document.getElementById("leaflet-css")){const o=document.createElement("link");o.id="leaflet-css",o.rel="stylesheet",o.href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css",document.head.appendChild(o)}h=n.map(T.value).setView([((s=i.vehicles[0])==null?void 0:s.lat)||.3476,((e=i.vehicles[0])==null?void 0:e.lng)||32.5825],13),n.tileLayer("https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",{maxZoom:19}).addTo(h),N.value=!0,O(n),h.on("click",o=>{Y.value=o.latlng.lat,r.value=o.latlng.lng,E.value&&(I.push([o.latlng.lat,o.latlng.lng]),x?x.addLatLng(o.latlng):x=n.polyline(I,{color:"#0ea5e9",weight:3,dashArray:"4 3"}).addTo(h))})}catch{N.value=!1}}function O(s){if(!h)return;F.forEach(n=>n.remove()),B.forEach(n=>n.remove()),Q.forEach(n=>n.remove()),F=i.vehicles.map(n=>{const o=s.divIcon({className:"vehicle-marker",html:`<div class='w-3 h-3 rounded-full ${n.alert?"bg-red-500 animate-pulse":"bg-emerald-500"} border border-white shadow'></div>`}),d=s.marker([n.lat,n.lng],{icon:o});return d.addTo(h).bindTooltip(`${n.id} ${n.alert?"⚠️":""}`),d});const e=(n,o)=>n?v(n):f[o%f.length];B=i.vehicles.map((n,o)=>{const d=i.history[n.id];if(!d||d.length<2)return null;const c=s.polyline(d,{color:e(n.route,o),weight:2,opacity:.6});return c.addTo(h),c}).filter(Boolean),Q=i.geofences.map(n=>{const o=s.circle([n.lat,n.lng],{radius:n.radiusM,color:"#10b981",weight:1,opacity:.6,fillOpacity:.08});o.addTo(h);const d=s.divIcon({className:"geofence-center",html:"<div class='w-2 h-2 rounded-full bg-emerald-500 border border-white shadow'></div>"}),c=s.marker([n.lat,n.lng],{draggable:!0,icon:d});c.addTo(h),c.on("drag",L=>{const w=L.target.getLatLng();o.setLatLng(w)}),c.on("dragend",L=>{const w=L.target.getLatLng();i.updateGeofenceCenter(n.id,w.lat,w.lng)});const y=s.divIcon({className:"geofence-handle",html:"<div class='w-2 h-2 rounded-full bg-white border border-emerald-600 shadow'></div>"}),A=s.marker(V(n.lat,n.lng,n.radiusM,90),{draggable:!0,icon:y});return A.addTo(h),A.on("drag",L=>{const w=L.target.getLatLng(),be=M(o.getLatLng().lat,o.getLatLng().lng,w.lat,w.lng);o.setRadius(be)}),A.on("dragend",L=>{const w=L.target.getLatLng(),be=M(o.getLatLng().lat,o.getLatLng().lng,w.lat,w.lng);i.updateGeofenceRadius(n.id,Math.round(be))}),[o,c,A]}).flat(),ie(s)}function oe(){i.simulateStep(),h&&W(()=>import("./leaflet-src-r9KgTLRM.js").then(s=>s.l),[]).then(s=>O(s))}function G(){i.clear(),i.initIfEmpty(),h&&W(()=>import("./leaflet-src-r9KgTLRM.js").then(s=>s.l),[]).then(s=>O(s))}function me(){G()}function ge(s){K.value=s}function $(){K.value=null}function fe(){const s=i.exportVehiclesCsv();se(`fleet-vehicles-${Date.now()}.csv`,s)}function he(){const s=i.exportAlertsCsv();se(`fleet-alerts-${Date.now()}.csv`,s)}function se(s,e){const n=new Blob([e],{type:"text/csv"}),o=URL.createObjectURL(n),d=document.createElement("a");d.href=o,d.download=s,document.body.appendChild(d),d.click(),d.remove(),URL.revokeObjectURL(o)}const j=b("");function ve(){j.value.trim()&&(i.addDriver(j.value.trim()),j.value="")}const Y=b(null),r=b(null),a=b(500);function l(){Y.value&&r.value&&(i.addGeofence("Fence "+(i.geofences.length+1),Y.value,r.value,a.value),W(()=>import("./leaflet-src-r9KgTLRM.js").then(s=>s.l),[]).then(s=>O(s)))}function u(s){i.removeGeofence(s),W(()=>import("./leaflet-src-r9KgTLRM.js").then(e=>e.l),[]).then(e=>O(e))}const f=["#6366f1","#f59e0b","#10b981","#ef4444","#0ea5e9","#8b5cf6"];function v(s){let e=0;for(let o=0;o<s.length;o++)e=(e<<5)-e+s.charCodeAt(o);const n=Math.abs(e)%f.length;return f[n]}const D=P(()=>{const s={};return i.vehicles.forEach((e,n)=>{e.route&&(s[e.route]=v(e.route))}),s});function M(s,e,n,o){const c=w=>w*Math.PI/180,y=c(n-s),A=c(o-e),L=Math.sin(y/2)**2+Math.cos(c(s))*Math.cos(c(n))*Math.sin(A/2)**2;return 2*6371e3*Math.atan2(Math.sqrt(L),Math.sqrt(1-L))}function V(s,e,n,o){const c=o*Math.PI/180,y=s*Math.PI/180,A=e*Math.PI/180,L=Math.asin(Math.sin(y)*Math.cos(n/6371e3)+Math.cos(y)*Math.sin(n/6371e3)*Math.cos(c)),w=A+Math.atan2(Math.sin(c)*Math.sin(n/6371e3)*Math.cos(y),Math.cos(n/6371e3)-Math.sin(y)*Math.sin(L));return[L*180/Math.PI,w*180/Math.PI]}function C(){E.value?(U.value.trim()&&I.length>1?(i.addCustomRoute(U.value.trim(),[...I]),W(()=>import("./leaflet-src-r9KgTLRM.js").then(s=>s.l),[]).then(s=>{x&&(x.remove(),x=null),O(s)})):x&&(x.remove(),x=null),E.value=!1):(E.value=!0,I.length=0,U.value="")}return Ce(()=>{i.initIfEmpty(),pe(),te=setInterval(()=>{Z.value&&oe()},1500)}),Le(()=>clearInterval(te)),Re(()=>i.config.vehicleCount,()=>{G()}),(s,e)=>(g(),m(H,null,[t("div",Ve,[e[22]||(e[22]=t("p",{class:"text-neutral-600 dark:text-neutral-400 max-w-prose"},"Mini fleet management prototype: simulated vehicle telemetry (location, fuel, engine temperature) with basic alerts and map visualization.",-1)),t("div",Ae,[t("div",Se,[t("div",Ue,[t("div",{ref_key:"mapEl",ref:T,class:"absolute inset-0 z-10"},null,512),N.value?re("",!0):(g(),m("div",Ne,"Loading map…")),t("div",{class:"absolute top-2 left-2 flex gap-2 flex-wrap z-20"},[t("button",{onClick:fe,class:"px-2 py-0.5 rounded bg-white/80 dark:bg-neutral-800/80 text-[10px] border border-neutral-300 dark:border-neutral-600 backdrop-blur"},"Export Vehicles CSV"),t("button",{onClick:he,class:"px-2 py-0.5 rounded bg-white/80 dark:bg-neutral-800/80 text-[10px] border border-neutral-300 dark:border-neutral-600 backdrop-blur"},"Export Alerts CSV")]),t("div",Ge,[e[8]||(e[8]=t("div",{class:"text-[10px] font-semibold mb-1"},"Routes",-1)),t("ul",Pe,[(g(!0),m(H,null,q(D.value,(n,o)=>(g(),m("li",{key:o,class:"flex items-center gap-1"},[t("span",{class:"inline-block w-3 h-1 rounded",style:Te({background:n})},null,4),R(p(o),1)]))),128))])])]),t("div",Oe,[t("div",ze,[e[10]||(e[10]=t("h3",{class:"font-semibold text-sm"},"Vehicles",-1)),t("div",Ke,[t("label",$e,[e[9]||(e[9]=R("Auto ")),S(t("input",{type:"checkbox","onUpdate:modelValue":e[0]||(e[0]=n=>Z.value=n)},null,512),[[Ee,Z.value]])]),t("button",{onClick:oe,class:"px-2 py-0.5 rounded bg-neutral-200 dark:bg-neutral-800"},"Tick"),t("button",{onClick:G,class:"px-2 py-0.5 rounded bg-neutral-100 dark:bg-neutral-800"},"Reset")]),t("div",je,[t("span",null,"Avg Fuel "+p(k(i).avgFuel.toFixed(1))+"%",1),t("span",null,"Alerts "+p(k(i).vehicleAlertCount),1),t("span",null,"Dist Σ "+p(k(i).totalDistanceToday.toFixed(1))+"km",1)])]),t("div",He,[t("table",Be,[e[13]||(e[13]=t("thead",{class:"text-neutral-500"},[t("tr",{class:"text-left"},[t("th",{class:"py-1 pr-2 font-medium"},"ID"),t("th",{class:"py-1 pr-2 font-medium"},"Driver"),t("th",{class:"py-1 pr-2 font-medium"},"Route"),t("th",{class:"py-1 pr-2 font-medium"},"Fuel"),t("th",{class:"py-1 pr-2 font-medium"},"Temp"),t("th",{class:"py-1 pr-2 font-medium"},"Updated"),t("th",{class:"py-1 pr-2 font-medium"},"ETA"),t("th",{class:"py-1 pr-2 font-medium"},"Alert")])],-1)),t("tbody",null,[(g(!0),m(H,null,q(k(i).vehicles,n=>(g(),m("tr",{key:n.id,class:"border-t border-neutral-100 dark:border-neutral-800 cursor-pointer hover:bg-neutral-50 dark:hover:bg-neutral-800/40",onClick:o=>ge(n.id)},[t("td",We,p(n.id),1),t("td",Je,[S(t("select",{"onUpdate:modelValue":o=>n.driver=o,class:"w-24 bg-transparent border border-neutral-200 dark:border-neutral-700 rounded px-1 py-0.5"},[e[11]||(e[11]=t("option",{value:"",disabled:""},"Assign…",-1)),(g(!0),m(H,null,q(k(i).drivers,o=>(g(),m("option",{key:o,value:o},p(o),9,Ze))),128))],8,Qe),[[ke,n.driver]])]),t("td",Xe,[S(t("select",{"onUpdate:modelValue":o=>n.route=o,class:"w-32 bg-transparent border border-neutral-200 dark:border-neutral-700 rounded px-1 py-0.5",onClick:e[1]||(e[1]=xe(()=>{},["stop"]))},[e[12]||(e[12]=t("option",{value:""},"None",-1)),(g(!0),m(H,null,q(k(i).allRouteNames(),o=>(g(),m("option",{key:o,value:o},p(o),9,et))),128))],8,Ye),[[ke,n.route]])]),t("td",tt,p(n.fuel.toFixed(1))+"%",1),t("td",{class:ee(["py-1 pr-2",n.engineTemp>k(i).config.engineTempHigh?"text-red-600 dark:text-red-400":""])},p(n.engineTemp.toFixed(1))+"°C",3),t("td",nt,p(le(n.lastUpdate)),1),t("td",at,[n.route?(g(),m("span",lt,[ae(n.id).etaSeconds!==null?(g(),m("span",ot,p(ue(ae(n.id).etaSeconds)),1)):(g(),m("span",st,"—"))])):(g(),m("span",rt,"—"))]),t("td",it,[n.alert?(g(),m("span",{key:0,class:ee([n.alert==="ENGINE"?"bg-red-100 text-red-700 dark:bg-red-900/40 dark:text-red-300":"bg-amber-100 text-amber-700 dark:bg-amber-900/40 dark:text-amber-300","px-2 py-0.5 rounded-full text-[10px] font-medium"])},p(n.alert),3)):re("",!0)])],8,qe))),128))])])])])]),t("div",dt,[t("div",ut,[e[14]||(e[14]=t("h3",{class:"font-semibold text-sm"},"Alerts",-1)),t("ul",ct,[(g(!0),m(H,null,q(k(i).activeAlerts,n=>(g(),m("li",{key:n.id,class:"flex items-center gap-2 text-[11px]"},[t("span",pt,p(ce(n.ts)),1),t("span",mt,p(n.vehicleId),1),t("span",{class:ee(n.type==="ENGINE"?"text-red-600 dark:text-red-400":"text-amber-600 dark:text-amber-400")},p(n.message),3)]))),128))])]),t("div",gt,[e[18]||(e[18]=t("h3",{class:"font-semibold text-sm"},"Config",-1)),t("div",ft,[t("label",ht,[e[15]||(e[15]=R("Vehicles ")),S(t("input",{type:"number",min:"1",max:"20","onUpdate:modelValue":e[2]||(e[2]=n=>k(i).config.vehicleCount=n),class:"w-16 px-1 py-0.5 rounded border border-neutral-300 dark:border-neutral-700 bg-transparent"},null,512),[[z,k(i).config.vehicleCount,void 0,{number:!0}]])]),t("label",vt,[e[16]||(e[16]=R("Engine High ")),S(t("input",{type:"number","onUpdate:modelValue":e[3]||(e[3]=n=>k(i).config.engineTempHigh=n),class:"w-20 px-1 py-0.5 rounded border border-neutral-300 dark:border-neutral-700 bg-transparent"},null,512),[[z,k(i).config.engineTempHigh,void 0,{number:!0}]])]),t("label",bt,[e[17]||(e[17]=R("Fuel Warn ")),S(t("input",{type:"number","onUpdate:modelValue":e[4]||(e[4]=n=>k(i).config.minFuelWarn=n),class:"w-20 px-1 py-0.5 rounded border border-neutral-300 dark:border-neutral-700 bg-transparent"},null,512),[[z,k(i).config.minFuelWarn,void 0,{number:!0}]])]),t("div",xt,[S(t("input",{"onUpdate:modelValue":e[5]||(e[5]=n=>j.value=n),placeholder:"New driver",class:"flex-1 px-1 py-0.5 rounded border border-neutral-300 dark:border-neutral-700 bg-transparent"},null,512),[[z,j.value]]),t("button",{onClick:ve,class:"px-2 py-0.5 rounded bg-neutral-200 dark:bg-neutral-800"},"Add")]),t("div",yt,[t("button",{onClick:C,class:ee(["px-2 py-0.5 rounded text-[10px]",E.value?"bg-emerald-600 text-white":"bg-neutral-200 dark:bg-neutral-800"])},p(E.value?"Finish Route":"Draw Route"),3),E.value?S((g(),m("input",{key:0,"onUpdate:modelValue":e[6]||(e[6]=n=>U.value=n),placeholder:"Route name",class:"flex-1 px-1 py-0.5 rounded border border-neutral-300 dark:border-neutral-700 bg-transparent"},null,512)),[[z,U.value]]):re("",!0)]),E.value?(g(),m("p",kt,"Click map to add points ("+p(I.length)+"). Enter a name, then Finish to save.",1)):(g(),m("p",_t,"Need a new path? Click Draw Route, map-click to trace, then Finish."))]),e[19]||(e[19]=t("p",{class:"text-[10px] text-neutral-500"},"Adjust thresholds & reinitialize to apply to all vehicles.",-1)),t("button",{onClick:me,class:"px-3 py-1 rounded bg-neutral-900 text-white dark:bg-white dark:text-neutral-900 text-[11px] font-medium"},"Reinitialize")]),t("div",wt,[e[20]||(e[20]=t("h3",{class:"font-semibold text-sm"},"Geofences",-1)),t("ul",Mt,[(g(!0),m(H,null,q(k(i).geofences,n=>(g(),m("li",{key:n.id,class:"flex items-center gap-2 text-[11px]"},[S(t("input",{"onUpdate:modelValue":o=>n.name=o,class:"px-1 py-0.5 w-24 rounded border border-neutral-300 dark:border-neutral-700 bg-transparent"},null,8,Ct),[[z,n.name]]),S(t("input",{type:"number","onUpdate:modelValue":o=>n.radiusM=o,class:"w-20 px-1 py-0.5 rounded border border-neutral-300 dark:border-neutral-700 bg-transparent"},null,8,Lt),[[z,n.radiusM,void 0,{number:!0}]]),t("button",{onClick:o=>u(n.id),class:"px-2 py-0.5 rounded bg-neutral-200 dark:bg-neutral-800"},"✕",8,Rt)]))),128))]),t("div",Et,[S(t("input",{"onUpdate:modelValue":e[7]||(e[7]=n=>a.value=n),type:"number",class:"w-20 px-1 py-0.5 rounded border border-neutral-300 dark:border-neutral-700 bg-transparent"},null,512),[[z,a.value,void 0,{number:!0}]]),t("button",{onClick:l,class:"px-2 py-0.5 rounded bg-neutral-200 dark:bg-neutral-800"},"Add Fence")]),e[21]||(e[21]=t("p",{class:"text-[10px] text-neutral-500"},"Click on map to add geofence center (radius meters).",-1))])])])]),_.value?(g(),m("div",{key:0,class:"fixed inset-0 z-50 flex items-start justify-center p-6 bg-black/40 backdrop-blur-sm",onKeydown:De($,["esc"]),onClick:xe($,["self"])},[t("div",Dt,[t("button",{onClick:$,class:"absolute top-2 right-2 text-neutral-500 hover:text-neutral-800 dark:hover:text-neutral-200","aria-label":"Close"},"✕"),t("h2",Tt,[R(p(_.value.id)+" ",1),t("span",Ft,p(_.value.name),1)]),t("div",It,[t("div",Vt,[t("div",null,[e[23]||(e[23]=t("span",{class:"text-neutral-500"},"Driver:",-1)),R(" "+p(_.value.driver||"—"),1)]),t("div",null,[e[24]||(e[24]=t("span",{class:"text-neutral-500"},"Route:",-1)),R(" "+p(_.value.route||"—"),1)]),t("div",null,[e[25]||(e[25]=t("span",{class:"text-neutral-500"},"Fuel:",-1)),R(" "+p(_.value.fuel.toFixed(1))+"%",1)]),t("div",null,[e[26]||(e[26]=t("span",{class:"text-neutral-500"},"Engine:",-1)),R(" "+p(_.value.engineTemp.toFixed(1))+"°C",1)])]),t("div",At,[t("div",null,[e[27]||(e[27]=t("span",{class:"text-neutral-500"},"Odometer:",-1)),R(" "+p(_.value.odometerKm.toFixed(1))+" km",1)]),t("div",null,[e[28]||(e[28]=t("span",{class:"text-neutral-500"},"Updated:",-1)),R(" "+p(le(_.value.lastUpdate)),1)]),t("div",null,[e[29]||(e[29]=t("span",{class:"text-neutral-500"},"Alert:",-1)),e[30]||(e[30]=R()),_.value.alert?(g(),m("span",{key:0,class:ee(_.value.alert==="ENGINE"?"text-red-600 dark:text-red-400":"text-amber-600 dark:text-amber-400")},p(_.value.alert),3)):(g(),m("span",St,"OK"))])])]),t("div",Ut,[t("h3",Nt,"Recent Path ("+p(X.value.length)+" pts)",1),ye(_e,{values:de.value,width:220,height:40,color:"#6366f1","show-area":!0},null,8,["values"]),ye(_e,{values:ne.value,width:220,height:40,color:"#10b981","show-area":!0},null,8,["values"]),e[31]||(e[31]=t("p",{class:"text-[10px] text-neutral-500"},"Latitude / Longitude variation (not to scale).",-1))]),t("div",{class:"flex justify-end gap-2"},[t("button",{onClick:$,class:"px-3 py-1 rounded bg-neutral-200 dark:bg-neutral-800 text-[11px]"},"Close")])])],32)):re("",!0)],64))}}),zt=Fe(Gt,[["__scopeId","data-v-16e5001f"]]);export{zt as default};
