import{M as ue,i as k,c as b,d as pe,N as ce,a as i,o as d,b as e,e as h,F as T,h as w,p as D,v as ge,u as p,n as O,t as o,G as te,g as F,O as Z,L as fe}from"./index-B72CjnCX.js";const ve=ue("transport",()=>{const C=k([]),a=k([{id:"veh-1",label:"Bus 1"},{id:"veh-2",label:"Mini 2"},{id:"veh-3",label:"Taxi 3"}]),G=k([{name:"Central Loop",baseFare:1500,distanceKm:5.2},{name:"Airport Express",baseFare:8e3,distanceKm:42},{name:"Kampala â€“ Suburb",baseFare:2500,distanceKm:12.5},{name:"Late Night",baseFare:1800,distanceKm:6.3}]),x=k([]),_=k([]),I=k([]),E=k([]),M=k([]),v=k(!1),y=k(null),V=b(()=>_.value.reduce((r,l)=>r+l.fare,0)),K=b(()=>_.value.reduce((r,l)=>r+l.providerFee,0)),H=b(()=>x.value.filter(r=>r.status==="completed").length),q=b(()=>{const r=_.value.length;return r?V.value/r:0}),z=b(()=>{const r={};for(const l of _.value){const n=r[l.route]||(r[l.route]={revenue:0,trips:0});n.revenue+=l.fare,n.trips++}return Object.entries(r).map(([l,n])=>({route:l,...n})).sort((l,n)=>n.revenue-l.revenue)}),W=b(()=>{const r=Array.from({length:24},()=>0);for(const l of x.value)if(l.endTs&&l.status==="completed"){const n=new Date(l.endTs).getHours();r[n]++}return r}),B=b(()=>M.value.filter(r=>r.status==="pending")),$=b(()=>C.value.find(r=>r.id===y.value)||null),J=r=>x.value.filter(l=>l.vehicleId===r&&l.status==="in_progress"),j=b(()=>x.value.filter(r=>r.status==="placed")),R=b(()=>{const r={};for(const l of I.value){const n=r[l.provider]||(r[l.provider]={count:0,volume:0,fees:0});l.status==="success"&&(n.count++,n.volume+=l.amountOriginal,n.fees+=l.fee)}return Object.entries(r).map(([l,n])=>({provider:l,...n})).sort((l,n)=>n.volume-l.volume)});function A(r){return r+Math.random().toString(36).slice(2,9)}function Q(r){const l=C.value.find(c=>c.name.toLowerCase()===r.toLowerCase());if(l)return l;const n={id:"P"+Date.now().toString(36)+Math.random().toString(36).slice(2,5),name:r,wallet:0,created:new Date().toISOString()};return C.value.push(n),n}function L(r){const l=Q(r);y.value=l.id}function Y(){y.value=null}function S(r,l){const n={id:A("EV_"),type:r,payload:l,ts:new Date().toISOString(),status:v.value?"pending":"processed"};M.value.unshift(n),v.value||X(n)}function X(r){var l;try{if(r.type==="TOP_UP"){const n=C.value.find(g=>g.id===r.payload.passengerId),c=!v.value&&Math.random()<.05;if(n&&!c&&(n.wallet+=r.payload.amountCredited),I.value.unshift({id:A("TU_"),passengerId:r.payload.passengerId,provider:r.payload.provider,amountOriginal:r.payload.amountOriginal,fee:r.payload.fee,amountCredited:r.payload.amountCredited,ts:r.ts,status:c?"failed":"success"}),c)throw new Error("Provider declined transaction")}else if(r.type==="PLACE_TRIP"){const n=C.value.find(m=>m.id===r.payload.passengerId);if(!n)throw new Error("Passenger missing");if(n.activeTripId)throw new Error("Passenger already in trip");const c=G.value.find(m=>m.name===r.payload.route);if(!c)throw new Error("Route missing");const g=s(c);if(n.wallet<g.estimatedFare)throw new Error("Insufficient balance for estimate");const U={id:A("T_"),passengerId:n.id,route:c.name,placedTs:r.ts,fareEstimate:g.estimatedFare,status:"placed",surgeMultiplier:g.surgeMultiplier};x.value.unshift(U)}else if(r.type==="ASSIGN_TRIP"){const n=x.value.find(c=>c.id===r.payload.tripId);if(!n||n.status!=="placed")throw new Error("Trip not placeable");n.vehicleId=r.payload.vehicleId}else if(r.type==="START_TRIP"){const n=x.value.find(g=>g.id===r.payload.tripId);if(!n||n.status!=="placed")throw new Error("Trip not ready");n.vehicleId||(n.vehicleId=r.payload.vehicleId),n.startTs=r.ts,n.status="in_progress";const c=C.value.find(g=>g.id===n.passengerId);c&&(c.activeTripId=n.id)}else if(r.type==="END_TRIP"){const n=x.value.find(P=>P.id===r.payload.tripId);if(!n||n.status!=="in_progress")return;const c=C.value.find(P=>P.id===n.passengerId),g=G.value.find(P=>P.name===n.route),U=g?s(g,n.surgeMultiplier):{estimatedFare:1e3,surgeMultiplier:1,baseFare:1e3};if(!c)throw new Error("Passenger missing");const m=U.estimatedFare;if(c.wallet<m)n.status="failed",n.endTs=new Date().toISOString();else{c.wallet-=m;const P=Math.round(m*.015),ie=m-P;n.fare=m,n.endTs=new Date().toISOString(),n.status="completed",c.activeTripId=void 0;const de={id:A("R_"),tripId:n.id,passengerId:n.passengerId,route:n.route,fare:m,providerFee:P,net:ie,ts:n.endTs};_.value.unshift(de)}}else if(r.type==="CANCEL_TRIP"){const n=x.value.find(g=>g.id===r.payload.tripId);if(!n||!(n.status==="placed"||n.status==="in_progress"))return;n.status="cancelled",n.endTs=new Date().toISOString();const c=C.value.find(g=>g.id===n.passengerId);c&&c.activeTripId===n.id&&(c.activeTripId=void 0)}else if(r.type==="SETTLE"){const n=(l=E.value[0])==null?void 0:l.ts,c=_.value.filter(m=>n?m.ts>n:!0);if(!c.length)return;const g=c.reduce((m,P)=>m+P.fare,0),U=c.reduce((m,P)=>m+P.providerFee,0);E.value.unshift({id:A("SB_"),ts:r.ts,trips:c.length,gross:g,providerFees:U,net:g-U})}r.status="processed"}catch(n){r.status="failed",r.error=(n==null?void 0:n.message)||"error"}}function u(){for(const r of M.value.slice().reverse())r.status==="pending"&&X(r)}function t(){v.value=!v.value,v.value||u()}function N(r,l){const n=new Date().getHours(),c=l??(n>=6&&n<=9||n>=17&&n<=20?1.25:1);return{baseFare:r.baseFare,surgeMultiplier:c,estimatedFare:Math.round(r.baseFare*c)}}function s(r,l){return N(r,l)}function f(r,l){const n={"MTN Momo":{percent:.01,fixed:50},"Airtel Money":{percent:.008,fixed:30},MockCard:{percent:.012,fixed:0}},c=n[r]||n["MTN Momo"],g=Math.round(l*c.percent)+c.fixed,U=Math.max(0,l-g);return{fee:g,credited:U}}function ee(r,l,n){const{fee:c,credited:g}=f(n,l);S("TOP_UP",{passengerId:r,amountOriginal:l,fee:c,amountCredited:g,provider:n})}function se(r,l){S("PLACE_TRIP",{passengerId:r,route:l})}function re(r,l){S("ASSIGN_TRIP",{tripId:r,vehicleId:l})}function ne(r,l){S("START_TRIP",{tripId:r,vehicleId:l})}function ae(r){S("END_TRIP",{tripId:r})}function le(r){S("CANCEL_TRIP",{tripId:r})}function oe(){S("SETTLE",{})}return{passengers:C,vehicles:a,routes:G,trips:x,receipts:_,settlements:E,topUps:I,events:M,offline:v,authPassengerId:y,authPassenger:$,totalRevenue:V,totalProviderFees:K,tripsCompleted:H,avgFare:q,routeRevenue:z,hourBuckets:W,pendingEvents:B,activeTripsForVehicle:J,placedTrips:j,providerStats:R,fareEstimate:s,computeTopUpFees:f,loginPassenger:L,logoutPassenger:Y,topUp:ee,placeTrip:se,assignTrip:re,startTrip:ne,endTrip:ae,cancelTrip:le,settle:oe,toggleOffline:t,processPending:u}},{persist:{key:"transport",paths:["passengers","vehicles","routes","trips","receipts","events","settlements","topUps"]}}),be={class:"space-y-5 text-xs"},xe={class:"flex flex-wrap gap-2 text-[11px]"},me=["onClick"],he={class:"ml-auto flex items-center gap-2"},ye={class:"inline-flex items-center gap-1 cursor-pointer"},ke={key:0,class:"space-y-4"},_e={class:"flex flex-wrap items-end gap-3"},Te=["disabled"],we={key:1,class:"ml-auto text-[11px]"},Pe={key:0,class:"space-y-3"},Ie={class:"flex flex-wrap gap-2 items-end"},Ce={key:0,class:"text-[11px] text-neutral-600 dark:text-neutral-400"},Se={class:"font-semibold"},Fe=["disabled"],Ee={class:"flex flex-wrap gap-3 items-end"},Me=["value"],Ue={key:0,class:"text-[11px] text-neutral-600 dark:text-neutral-400"},Re=["disabled"],Ae={key:0,class:"text-rose-600 text-[11px]"},Ne={class:"grid md:grid-cols-2 gap-4"},Le={class:"w-full text-[11px] border-separate border-spacing-y-1"},De={class:"px-2 py-1 font-mono"},Oe={class:"px-2 py-1"},Ge={class:"px-2 py-1 text-right"},Ve={class:"px-2 py-1 text-right"},Xe={class:"px-2 py-1"},Be={class:"px-2 py-1"},$e={class:"px-2 py-1"},je={class:"w-full text-[11px] border-separate border-spacing-y-1"},Ke={class:"px-2 py-1"},He={class:"px-2 py-1"},qe={class:"px-2 py-1 text-right"},ze={class:"px-2 py-1 text-right"},We={class:"px-2 py-1 text-right"},Je={class:"px-2 py-1"},Qe={key:1,class:"text-neutral-500"},Ye={key:1,class:"space-y-4"},Ze={class:"p-3 rounded border border-neutral-200 dark:border-neutral-700 bg-white dark:bg-neutral-900"},et={class:"font-semibold text-[12px] mb-2"},tt={class:"flex flex-wrap gap-2"},st={class:"font-mono"},rt=["onUpdate:modelValue"],nt=["value"],at=["onClick","disabled"],lt=["onClick"],ot={key:0,class:"text-neutral-400 text-[11px]"},it={class:"grid md:grid-cols-3 gap-4"},dt={class:"font-semibold text-[12px] flex items-center justify-between"},ut={class:"text-[10px] text-neutral-400"},pt={class:"space-y-1 max-h-36 overflow-auto pr-1"},ct={class:"truncate"},gt=["onClick"],ft={key:0,class:"text-neutral-400 text-[11px]"},vt={key:2,class:"space-y-4"},bt={class:"grid md:grid-cols-3 gap-4"},xt={class:"p-3 rounded bg-white dark:bg-neutral-900 border border-neutral-200 dark:border-neutral-700 space-y-2"},mt={class:"space-y-1"},ht={class:"p-3 rounded bg-white dark:bg-neutral-900 border border-neutral-200 dark:border-neutral-700 space-y-2"},yt={class:"space-y-1 max-h-40 overflow-auto pr-1"},kt={class:"font-mono"},_t={key:0,class:"text-neutral-400"},Tt={class:"p-3 rounded bg-white dark:bg-neutral-900 border border-neutral-200 dark:border-neutral-700 space-y-2"},wt={class:"space-y-1 max-h-40 overflow-auto pr-1"},Pt={class:"font-mono"},It={key:0,class:"text-neutral-400"},Ct={class:"p-3 rounded bg-white dark:bg-neutral-900 border border-neutral-200 dark:border-neutral-700 space-y-2"},St={class:"grid grid-cols-6 gap-1 text-[9px]"},Ft={class:"text-center mt-0.5 text-neutral-500"},Et={class:"grid md:grid-cols-2 gap-4"},Mt={class:"p-3 rounded border border-neutral-200 dark:border-neutral-700 bg-white dark:bg-neutral-900 space-y-2"},Ut={class:"flex items-center gap-2"},Rt={class:"w-full text-[11px] border-separate border-spacing-y-1"},At={class:"px-2 py-1 font-mono"},Nt={class:"px-2 py-1 text-right"},Lt={class:"px-2 py-1 text-right"},Dt={class:"px-2 py-1 text-right"},Ot={class:"px-2 py-1 text-right"},Gt={class:"px-2 py-1"},Vt={key:0},Xt={class:"p-3 rounded border border-neutral-200 dark:border-neutral-700 bg-white dark:bg-neutral-900 space-y-2"},Bt={class:"space-y-1"},$t={key:0},jt={class:"font-semibold mb-1"},Kt={class:"space-y-1 max-h-48 overflow-auto pr-1 font-mono"},Ht={class:"text-neutral-500"},qt={class:"ml-auto text-neutral-400"},Wt=pe({__name:"CashlessTransportDemo",setup(C){const a=ve(),G=["Passenger","Driver","Admin"],x=k("Passenger"),_=k(""),I=k(5e3),E=k("MTN Momo"),M=b(()=>I.value>0?a.computeTopUpFees(E.value,I.value):null),v=k(""),y=b(()=>v.value&&a.routes.find(u=>u.name===v.value)?a.fareEstimate(a.routes.find(u=>u.name===v.value)):null),V=b(()=>a.authPassenger&&y.value?a.authPassenger.wallet>=y.value.estimatedFare:!1);function K(){_.value.trim()&&a.loginPassenger(_.value.trim())}function H(){a.authPassenger&&(a.topUp(a.authPassenger.id,I.value,E.value),I.value=5e3)}const q=b(()=>a.topUps.filter(u=>{var t;return((t=a.authPassenger)==null?void 0:t.id)===u.passengerId}).slice(0,12));function z(){a.authPassenger&&v.value&&a.placeTrip(a.authPassenger.id,v.value)}function W(u){a.cancelTrip(u)}function B(u){a.endTrip(u)}const $=b(()=>{var u;return(u=a.authPassenger)!=null&&u.activeTripId?a.trips.find(t=>t.id===a.authPassenger.activeTripId):null}),J=b(()=>a.trips.filter(u=>{var t;return u.passengerId===((t=a.authPassenger)==null?void 0:t.id)}).slice(0,12)),j=b(()=>a.trips.filter(u=>{var t;return u.passengerId===((t=a.authPassenger)==null?void 0:t.id)&&u.status==="placed"})),R=ce({});function A(u){const t=R[u];t&&a.assignTrip(u,t)}function Q(u){var N;const t=((N=a.trips.find(s=>s.id===u))==null?void 0:N.vehicleId)||R[u];t&&a.startTrip(u,t)}function L(u){return u?new Date(u).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"}):"-"}function Y(u){return u==="completed"?"bg-emerald-100 dark:bg-emerald-900/30 text-emerald-700 dark:text-emerald-300":u==="failed"||u==="cancelled"?"bg-rose-100 dark:bg-rose-900/30 text-rose-700 dark:text-rose-300":u==="placed"?"bg-neutral-100 dark:bg-neutral-800 text-neutral-600 dark:text-neutral-300":"bg-indigo-100 dark:bg-indigo-900/30 text-indigo-700 dark:text-indigo-300"}function S(u){const t=(Date.now()-new Date(u).getTime())/1e3;return t<60?Math.floor(t)+"s":t<3600?Math.floor(t/60)+"m":Math.floor(t/3600)+"h"}function X(u){return u.slice(0,6)}return(u,t)=>{var N;return d(),i("div",be,[t[41]||(t[41]=e("p",{class:"text-neutral-600 dark:text-neutral-400 leading-relaxed"},"Prototype cashless transport workflow: passenger wallet topâ€‘up & trip lifecycle, driver boarding validation, offline queue replay, and operator revenue analytics (all simulated locally).",-1)),e("div",xe,[(d(),i(T,null,w(G,s=>e("button",{key:s,onClick:f=>x.value=s,class:O(["px-3 py-1 rounded border",x.value===s?"bg-neutral-900 text-white dark:bg-white dark:text-neutral-900 border-neutral-900 dark:border-white":"border-neutral-300 dark:border-neutral-700 hover:bg-neutral-100 dark:hover:bg-neutral-800"])},o(s),11,me)),64)),e("div",he,[e("label",ye,[D(e("input",{type:"checkbox","onUpdate:modelValue":t[0]||(t[0]=s=>p(a).offline=s),class:"accent-amber-600"},null,512),[[ge,p(a).offline]]),e("span",{class:O(p(a).offline?"text-amber-600":"text-neutral-500")},"Offline",2)]),p(a).offline&&p(a).pendingEvents.length?(d(),i("button",{key:0,onClick:t[1]||(t[1]=s=>p(a).processPending()),class:"px-2 py-1 rounded bg-amber-600 text-white"},"Process ("+o(p(a).pendingEvents.length)+")",1)):h("",!0)])]),x.value==="Passenger"?(d(),i("div",ke,[e("div",_e,[e("div",null,[t[11]||(t[11]=e("label",{class:"block text-[10px] uppercase tracking-wide mb-1"},"Passenger Name",-1)),D(e("input",{"onUpdate:modelValue":t[2]||(t[2]=s=>_.value=s),placeholder:"e.g. Amina",class:"px-2 py-1 rounded border border-neutral-300 dark:border-neutral-700 bg-white dark:bg-neutral-800"},null,512),[[te,_.value]])]),e("button",{onClick:t[3]||(t[3]=s=>K()),class:"px-3 py-2 rounded bg-emerald-600 text-white",disabled:!_.value.trim()},o(p(a).authPassenger?"Switch":"Login"),9,Te),p(a).authPassenger?(d(),i("button",{key:0,onClick:t[4]||(t[4]=s=>p(a).logoutPassenger()),class:"px-3 py-2 rounded bg-neutral-200 dark:bg-neutral-800"},"Logout")):h("",!0),p(a).authPassenger?(d(),i("div",we,[t[12]||(t[12]=e("span",{class:"font-semibold"},"Wallet:",-1)),F(" UGX "+o(p(a).authPassenger.wallet.toLocaleString()),1)])):h("",!0)]),p(a).authPassenger?(d(),i("div",Pe,[e("div",Ie,[e("div",null,[t[13]||(t[13]=e("label",{class:"block text-[10px] uppercase mb-1"},"Amount (UGX)",-1)),D(e("input",{type:"number","onUpdate:modelValue":t[5]||(t[5]=s=>I.value=s),class:"w-32 px-2 py-1 rounded border border-neutral-300 dark:border-neutral-700 bg-white dark:bg-neutral-800",placeholder:"Top-up"},null,512),[[te,I.value,void 0,{number:!0}]])]),e("div",null,[t[15]||(t[15]=e("label",{class:"block text-[10px] uppercase mb-1"},"Provider",-1)),D(e("select",{"onUpdate:modelValue":t[6]||(t[6]=s=>E.value=s),class:"px-2 py-1 rounded border border-neutral-300 dark:border-neutral-700 bg-white dark:bg-neutral-800"},t[14]||(t[14]=[e("option",null,"MTN Momo",-1),e("option",null,"Airtel Money",-1),e("option",null,"MockCard",-1)]),512),[[Z,E.value]])]),M.value?(d(),i("div",Ce,[F(" Fee "+o(M.value.fee)+" â†’ Credit ",1),e("span",Se,o(M.value.credited),1)])):h("",!0),e("button",{onClick:H,class:"px-3 py-1.5 rounded bg-indigo-600 text-white",disabled:I.value<=0},"Top Up",8,Fe)]),e("div",Ee,[e("div",null,[t[17]||(t[17]=e("label",{class:"block text-[10px] uppercase mb-1"},"Route",-1)),D(e("select",{"onUpdate:modelValue":t[7]||(t[7]=s=>v.value=s),class:"px-2 py-1 rounded border border-neutral-300 dark:border-neutral-700 bg-white dark:bg-neutral-800"},[t[16]||(t[16]=e("option",{disabled:"",value:""},"Select route",-1)),(d(!0),i(T,null,w(p(a).routes,s=>(d(),i("option",{key:s.name,value:s.name},o(s.name),9,Me))),128))],512),[[Z,v.value]])]),y.value?(d(),i("div",Ue,[F(" Est: UGX "+o(y.value.estimatedFare)+" ",1),e("span",{class:O(["ml-1",y.value.surgeMultiplier>1?"text-amber-600":""])},"(surge x"+o(y.value.surgeMultiplier)+")",3)])):h("",!0),e("button",{onClick:z,class:"px-3 py-1.5 rounded bg-neutral-900 text-white dark:bg-white dark:text-neutral-900",disabled:!v.value||!!((N=p(a).authPassenger)!=null&&N.activeTripId)||!V.value},"Place Trip",8,Re),j.value.length?(d(),i("button",{key:1,onClick:t[8]||(t[8]=s=>W(j.value[0].id)),class:"px-3 py-1.5 rounded bg-rose-600 text-white"},"Cancel")):h("",!0),$.value?(d(),i("button",{key:2,onClick:t[9]||(t[9]=s=>B($.value.id)),class:"px-3 py-1.5 rounded bg-rose-500 text-white"},"End Trip")):h("",!0)]),v.value&&!V.value?(d(),i("p",Ae,"Insufficient balance for estimated fare.")):h("",!0),e("div",Ne,[e("div",null,[t[19]||(t[19]=e("h3",{class:"font-semibold mb-1"},"My Trips",-1)),e("table",Le,[t[18]||(t[18]=e("thead",{class:"text-neutral-500"},[e("tr",null,[e("th",{class:"text-left"},"Trip"),e("th",{class:"text-left"},"Route"),e("th",null,"Est"),e("th",null,"Fare"),e("th",null,"Status"),e("th",null,"Start"),e("th",null,"End")])],-1)),e("tbody",null,[(d(!0),i(T,null,w(J.value,s=>(d(),i("tr",{key:s.id,class:"bg-white dark:bg-neutral-800"},[e("td",De,o(s.id),1),e("td",Oe,o(s.route),1),e("td",Ge,"UGX "+o(s.fareEstimate),1),e("td",Ve,o(s.fare?"UGX "+s.fare:"-"),1),e("td",Xe,[e("span",{class:O([Y(s.status),"px-1.5 py-0.5 rounded"])},o(s.status),3)]),e("td",Be,o(L(s.startTs)),1),e("td",$e,o(s.endTs?L(s.endTs):"-"),1)]))),128))])])]),e("div",null,[t[21]||(t[21]=e("h3",{class:"font-semibold mb-1"},"Top-Ups",-1)),e("table",je,[t[20]||(t[20]=e("thead",{class:"text-neutral-500"},[e("tr",null,[e("th",null,"Ts"),e("th",null,"Prov"),e("th",null,"Amt"),e("th",null,"Fee"),e("th",null,"Credited"),e("th",null,"Status")])],-1)),e("tbody",null,[(d(!0),i(T,null,w(q.value,s=>(d(),i("tr",{key:s.id,class:"bg-white dark:bg-neutral-800"},[e("td",Ke,o(L(s.ts)),1),e("td",He,o(s.provider),1),e("td",qe,o(s.amountOriginal),1),e("td",ze,o(s.fee),1),e("td",We,o(s.amountCredited),1),e("td",Je,[e("span",{class:O(s.status==="failed"?"text-rose-600":"text-emerald-600")},o(s.status),3)])]))),128))])])])])])):(d(),i("p",Qe,"Login or create a passenger to begin."))])):x.value==="Driver"?(d(),i("div",Ye,[t[24]||(t[24]=e("p",{class:"text-neutral-500"},"Placed trips awaiting assignment / start and active trips per vehicle.",-1)),e("div",Ze,[e("h3",et,"Unassigned Placed Trips ("+o(p(a).placedTrips.length)+")",1),e("div",tt,[(d(!0),i(T,null,w(p(a).placedTrips,s=>(d(),i("div",{key:s.id,class:"text-[11px] px-2 py-1 rounded bg-neutral-100 dark:bg-neutral-800 flex items-center gap-2"},[e("span",st,o(X(s.id)),1),e("span",null,o(s.route),1),D(e("select",{"onUpdate:modelValue":f=>R[s.id]=f,class:"px-1 py-0.5 rounded border border-neutral-300 dark:border-neutral-600 bg-white dark:bg-neutral-700"},[t[22]||(t[22]=e("option",{disabled:"",value:""},"Vehicle",-1)),(d(!0),i(T,null,w(p(a).vehicles,f=>(d(),i("option",{key:f.id,value:f.id},o(f.label),9,nt))),128))],8,rt),[[Z,R[s.id]]]),e("button",{onClick:f=>A(s.id),class:"px-2 py-0.5 rounded bg-indigo-600 text-white",disabled:!R[s.id]},"Assign",8,at),s.vehicleId?(d(),i("button",{key:0,onClick:f=>Q(s.id),class:"px-2 py-0.5 rounded bg-emerald-600 text-white"},"Start",8,lt)):h("",!0)]))),128)),p(a).placedTrips.length?h("",!0):(d(),i("p",ot,"None"))])]),e("div",it,[(d(!0),i(T,null,w(p(a).vehicles,s=>(d(),i("div",{key:s.id,class:"p-3 rounded border border-neutral-200 dark:border-neutral-700 bg-white dark:bg-neutral-900 space-y-2"},[e("h3",dt,[F(o(s.label)+" ",1),e("span",ut,o(p(a).activeTripsForVehicle(s.id).length)+" active",1)]),e("ul",pt,[(d(!0),i(T,null,w(p(a).activeTripsForVehicle(s.id),f=>(d(),i("li",{key:f.id,class:"text-[11px] flex items-center justify-between bg-neutral-100 dark:bg-neutral-800 rounded px-2 py-1"},[e("span",ct,o(f.route)+" â€¢ "+o(X(f.passengerId)),1),e("button",{onClick:ee=>B(f.id),class:"text-rose-600 hover:underline"},"End",8,gt)]))),128)),p(a).activeTripsForVehicle(s.id).length?h("",!0):(d(),i("li",ft,"No active trips"))]),t[23]||(t[23]=e("p",{class:"text-[11px] text-neutral-500"},"Trips must be placed then assigned.",-1))]))),128))])])):x.value==="Admin"?(d(),i("div",vt,[e("div",bt,[e("div",xt,[t[30]||(t[30]=e("h3",{class:"font-semibold text-[12px]"},"KPIs",-1)),e("ul",mt,[e("li",null,[t[25]||(t[25]=F("Total Revenue: ")),e("strong",null,"UGX "+o(p(a).totalRevenue.toLocaleString()),1)]),e("li",null,[t[26]||(t[26]=F("Provider Fees: ")),e("strong",null,"UGX "+o(p(a).totalProviderFees.toLocaleString()),1)]),e("li",null,[t[27]||(t[27]=F("Completed Trips: ")),e("strong",null,o(p(a).tripsCompleted),1)]),e("li",null,[t[28]||(t[28]=F("Avg Fare: ")),e("strong",null,"UGX "+o(Math.round(p(a).avgFare)),1)]),e("li",null,[t[29]||(t[29]=F("Pending Events: ")),e("strong",null,o(p(a).pendingEvents.length),1)])])]),e("div",ht,[t[31]||(t[31]=e("h3",{class:"font-semibold text-[12px]"},"Route Revenue",-1)),e("ul",yt,[(d(!0),i(T,null,w(p(a).routeRevenue,s=>(d(),i("li",{key:s.route,class:"flex justify-between"},[e("span",null,o(s.route),1),e("span",kt,"UGX "+o(s.revenue),1)]))),128)),p(a).routeRevenue.length?h("",!0):(d(),i("li",_t,"No data"))])]),e("div",Tt,[t[32]||(t[32]=e("h3",{class:"font-semibold text-[12px]"},"Provider Stats",-1)),e("ul",wt,[(d(!0),i(T,null,w(p(a).providerStats,s=>(d(),i("li",{key:s.provider,class:"flex justify-between"},[e("span",null,o(s.provider),1),e("span",Pt,o(s.count)+" â€¢ UGX "+o(s.volume),1)]))),128)),p(a).providerStats.length?h("",!0):(d(),i("li",It,"No data"))])]),e("div",Ct,[t[33]||(t[33]=e("h3",{class:"font-semibold text-[12px]"},"Trips / Hour",-1)),e("div",St,[(d(!0),i(T,null,w(p(a).hourBuckets,(s,f)=>(d(),i("div",{key:f,class:"h-8 flex flex-col justify-end"},[e("div",{style:fe({height:Math.min(100,s*10)+"%"}),class:"w-full bg-emerald-500/70 rounded"},null,4),e("span",Ft,o(f),1)]))),128))])])]),e("div",Et,[e("div",Mt,[e("div",Ut,[t[34]||(t[34]=e("h3",{class:"font-semibold text-[12px]"},"Settlement Batches",-1)),e("button",{onClick:t[10]||(t[10]=s=>p(a).settle()),class:"ml-auto px-2 py-1 rounded bg-indigo-600 text-white text-[11px]"},"Run Settlement")]),e("table",Rt,[t[36]||(t[36]=e("thead",{class:"text-neutral-500"},[e("tr",null,[e("th",{class:"text-left"},"Batch"),e("th",null,"Trips"),e("th",null,"Gross"),e("th",null,"Fees"),e("th",null,"Net"),e("th",null,"Ts")])],-1)),e("tbody",null,[(d(!0),i(T,null,w(p(a).settlements.slice(0,8),s=>(d(),i("tr",{key:s.id,class:"bg-white dark:bg-neutral-800"},[e("td",At,o(s.id),1),e("td",Nt,o(s.trips),1),e("td",Lt,o(s.gross),1),e("td",Dt,o(s.providerFees),1),e("td",Ot,o(s.net),1),e("td",Gt,o(L(s.ts)),1)]))),128)),p(a).settlements.length?h("",!0):(d(),i("tr",Vt,t[35]||(t[35]=[e("td",{colspan:"6",class:"text-center text-neutral-400 py-2"},"No settlements yet",-1)])))])])]),e("div",Xt,[t[39]||(t[39]=e("h3",{class:"font-semibold text-[12px]"},"Fare Components (Example)",-1)),t[40]||(t[40]=e("p",{class:"text-[11px] text-neutral-500"},"Estimates combine base fare * surge multiplier. Provider fee (1.5% approx) + fixed mobile money fee (1%) deducted at top-up time; per-trip provider fee applied at settlement.",-1)),e("ul",Bt,[y.value?(d(),i("li",$t,"Base: UGX "+o(y.value.baseFare)+" â€¢ Surge x"+o(y.value.surgeMultiplier)+" â†’ Est UGX "+o(y.value.estimatedFare),1)):h("",!0),t[37]||(t[37]=e("li",null,"Provider fee (trip): ~1.5% of fare",-1)),t[38]||(t[38]=e("li",null,"Top-up fee: 1% + 50 UGX base",-1))])])]),e("div",null,[e("h3",jt,"Recent Events ("+o(p(a).events.length)+")",1),e("ul",Kt,[(d(!0),i(T,null,w(p(a).events.slice(0,80),s=>(d(),i("li",{key:s.id,class:"px-2 py-1 rounded border border-neutral-200 dark:border-neutral-700 bg-white dark:bg-neutral-800 flex items-center gap-2"},[e("span",{class:O(s.status==="failed"?"text-rose-600":s.status==="pending"?"text-amber-600":"text-emerald-600")},o(s.type),3),e("span",Ht,o(s.id),1),e("span",qt,o(S(s.ts)),1)]))),128))])])])):h("",!0)])}}});export{Wt as default};
